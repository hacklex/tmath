# Равенство

Одно и то же число может быть записано по разному:

$$4 \qquad 100 \qquad \mathrm{IV} \qquad ||||$$

Другой пример: два различных представления одного и того же *вещественного* числа:

$$0.999 \qquad 1$$

Карта не есть территория.

Что же является территорией в математике? Ответ может быть разным:

- Платонизм: некие сущности в мире идей
- Интуиционизм: представления в голове у идеализованного математика
- Формализм: территории нет, есть только символы

Можно также рассмотреть связь между символами и представлениями в голове у *реального* математика. Это соответствие неидеально — математик может считать, что некоторое утверждение истино (хотя не доказано), и затем вывести факт, что оно на самом деле ложно.

Но мы ожидаем, что то, что на бумаге, и то, что в голове постепенно сходится — математик корректирует свои представления по мере взаимодействия с символами, и в свою очередь меняет выраженные в символах предположения так, чтобы их следствия соответствовали желаемой картине.

Так или иначе, но хорошая карта сохраняет отношения между вещами — и мы можем рассматривать отношения как таковые как территорию.

Важнейшим из отношений является равенство. Интуитивно, мы можем описать его свойства так:

1. Любая вещь равна сама себе
2. Равные вещи неразличимы

Формально же, они соответствуют следующим постулатам:

$$\begin{aligned}
rfl &: ∀\{x:τ\}.\; x = x \\
ndrec &: ∀\{x:α\}\{M: α → \mathcal U\ i\}.\; M\ x → \{y: α\} → (x = y) → M\ y
\end{aligned}$$

$rfl$ выражает первое свойство буквально. Но эта буквальность с точностью до вычислительного равенства, так как вычислительно равные типы неразличимы. Так, например, $2 + 2 = 4$ и $4 = 4$ это один и тот же тип — оба выражения вычисляются в $4 = 4$.

Соответствие между вторым свойством и $ndrec$ тоньше. Пусть $P$ это какое-то свойство, которому могут удовлетворять значения типа $τ$. Если значения $x\, y: τ$ равны, то свойство $P$ не может их различить: если $P\ x$ истинно, то и $P\ y$ должно быть истинно, и наоборот. $ndrec$ обобщает это рассуждение до любого типа: если $x = y$, то любому значению $M\ x$ соответствует некоторое значение $M\ y$.

В Lean, равенство это индуктивное семейство типов:

```lean
inductive Eq : α → α → Prop where
  | refl (a : α) : Eq a a
```

Соответствующий рекурсор отличается от $ndrec$ лишь тем, что $M$ также принимает тип равенства в качестве аргумента:

```
Eq.rec: {a: α} → {M: (b: α) → a = b → Sort u} →
  M a (_: a = a) → {b: α} → (e: a = b) → M b e
```

```lean
example {x y: α}(e: x = y): y = x :=
  Eq.ndrec (motive := λv => v = x) (rfl: x = x) e

```lean
example {x y: α}(e: x = y): y = x :=
  e ▸ (rfl: x = x)
```

```lean
example {x y z: α}(xy: x = y)(yz: y = z): x = z :=
  yz ▸ xy

example {x y: α}{f: α → β}(e: x = y): f x = f y :=
  e ▸ (rfl: f x = f x)
```


```lean
def BoolEq (a: Bool)(b: Bool): Prop :=
  a.rec (b.rec True False) (b.rec False True)

def bool_d: ∀b:Bool, BoolEq b b := Bool.rec ⟨⟩ ⟨⟩

theorem false_ne_true (h: false = true): False :=
   Eq.ndrec (bool_d false) h
```


```lean
example (P Q: Type)(pq: P ⊕ Q): Prop := pq.rec (λ_ => False) (λ_ => True)
```

```lean
example (P Q: Prop)(pq: P ∨ Q): Prop := pq.rec (λ_ => False) (λ_ => True)
```

$$∀(P:Prop)(x: P)(y:P).\; x = y$$

```lean
#check Subtype

def fls (_:Bool): Nat := false

#check
  let I := {b:Bool // ∃n, fls n = b}
  let z:I := ⟨false, ⟨0, rfl⟩⟩
  let s:I := ⟨false, ⟨1, rfl⟩⟩
  (rfl : z = s)
```

```lean
example: (∀a, α → α) → (∀α:Prop, α → α) :=
  λx => x (∀α, α → α) x
```
