Синтаксис:

$$\begin{aligned}
expr ::=\ &var & &\text{(имя переменной)} \\
\mid\quad &“λ” \, var\ “.”\ expr & &\text{(абстракция)} \\
\mid\quad &expr\ expr & &\text{(применение)}
\end{aligned}$$

Имя переменной может содержать более одного символа: $foo$ и $bar$ это тоже корректные имена. Мы различаем строчные буквы от заглавных, то есть $ab$ и $aB$ это два разных имени.

Применение левоассоциативно: ${?f}\ {?v_1}\ {?v_2}$ означает $({?f}\ {?v_1})\ {?v_2}$. Кроме того, абстракция захватывает всё, что находится справа её.

Ещё мы будем использовать следующее сокращение: 
- $λ{?v_1}\,{?v_2}.\; ?e$ означает $λ{?v_1}.\;(λ{?v_2}.\; {?e})$.
- $λ{?v_1}\,{?v_2}\,{?v_3}.\; ?e$ означает $λ{?v_1}.\;(λ{?v_2}.\; (λ{?v_3}.\;{?e}))$.
- И так далее

Например, $λ x\, y.\; x$ это то же самое, что и $λx.\; λ y.\; x$.

Предназначение переменных — указывать места для подстановки. Однако, наличие имён
у переменных порождает проблемы. Например, что означает $λx.\; λx.\; x$?

Чтобы ответить на этот вопрос, пронумеруем переменные при абстракциях, двигаясь *вниз* по
синтаксическому дереву.

$$λx^0.\; λx^1.\; x$$

На развилках мы продолжаем нумеровать параллельно. Например:

$$λf^0.\; (λx^1.\; x)\ (λy^1.\; y)\ (λz^1.\; z)$$

Мы решаем неоднозначность следующим образом: двигаясь *вверх* по синтаксическому дереву,
находим ближайшую абстракцию с той же переменной. Таким образом, получаем:

$$λx^0.\; λx^1.\; x^1$$

Переменная $x$ оказывается связанной с внутренней абстракцией, а не внешней.

Не все переменные возможно так пронумеровать. Например:

$$λx^0.\;(λz^1.\; z^1)\ z$$

Третье вхождение переменной $z$ оказывается без номера, так как выше по синтаксическому
дереву нет никакой абстракции
с именем $z$. Такое вхождение переменной в выражении называется свободным. Остальные же
вхождения переменных в выражении называются связанными.

Переменная называется свободной в выражении $?e$, если у неё есть хотя бы одно свободное
вхождение в выражении $?e$. Выражение называется замкнутым, если все вхождения переменных
в нём являются связанными.

Переменная называется свежей в выражении $?e$, если у неё нет вхождений в выражении $?e$.

Можно избавиться от имён связанных переменных, заменив их на номера. Такая форма
записи называется локально безымянной. Некоторые выражения, записанные в локально
безымянной форме:

$$\begin{aligned}
&λx.\;x &\qquad &λ.\; 0 \\
&λx.\;λy.\;y & &λ.\; λ.\ 1 \\
&(λx.\;λy.\; y\ x)\ z & &(λ.\;λ.\; 1\ 0)\ z
\end{aligned}$$

Выражения $?e_1$ и $?e_2$ называются альфа-эквивалентными (пишется $?e_1 =_α {?e_2}$),
если их локально безымянные формы совпадает. Альфа-эквивалентность выражает то,
что смысл выражения не зависит от имён связанных переменных: например, $λx.\;x$ и
$λt.\;t$ это по сути одно и то же выражение.

Далее, мы будем считать альфа-эквивалентные выражения одним и тем же выражением.

Свободные переменные можно рассматривать как внешние определения. С этой точки зрения,
уместно ввести операцию подстановки значения на место связанной переменной в выражении.

$?e[?x := {?v}]$ это выражение, где каждое свободное вхождение переменной $?x$ заменено
на выражение $?v$.

Например, результатом $(λx.\; I\ I\ x)[I := λt.\; t]$ будет $λx.\; (λt.\;t)\ (λt.\;t)\ x$.

Здесь есть тонкость, связанная со связыванием переменных. Если мы подставим $f := z$ в выражение
$λx.\; f\ x$, то получим $λx.\; z\ x$, где $z$ является свободной переменной. Однако,
если мы наивно сделаем ту же подстановку в $λz. f\ z$, то получим $λz.\; z\ z$ — выражениие,
где $z$ оказалась связанной.

Поэтому, подстановка должна давать свежие имена связанным переменным, чьи имена
совпадают с именами свободных переменных в подставляемом выражении. И результатом
$(λz.\; f\ z)[f := z]$ будет выражениие, где связанная переменная $z$ имеет другое
имя — например, $λt.\; z\ t$.

Определив подстановку, мы можем сформулировать правила вычисления лямбда-выражений:

$$\begin{aligned}
(λ?x.\;?e)\ ?v &\longrightarrow_β {?e}[{?x := {?v}}] & \text{(бета-редукция)} \\
(λ?x.\; {?f}\ {?x}) &\longrightarrow_η {?f} & \text{(эта-редукция)}
\end{aligned}$$

Применение правила сводится к замене подвыражения, соответсвующего левой части правила, на
выражение в правой части правила. Подвыражение, соответствующее левой части называется
редексом.

Эта-редукция применима только в том случае, когда в $?f$ нет свободных вхождений переменной $?x$.

Мы пишем $?e_1 ⟶ ?e_2$, если применение бета- или эта-редукции к $?e_1$ даёт выражение $?e_2$.
Мы пишем ${?e_1} \xrightarrow{*} {?e_2}$, если применение конечного числа (включая нуль)
редукций к выражению $?e_1$ даёт выражение $?e_2$.

$$\begin{aligned}
(λx\,y.\; x)\ ((λx.\;x)\ z) &⟶ λy.\; ((λx.\;x)\ z) &⟶ λy.\;z \\
(λx\,y.\; x)\ ((λx.\;x)\ z) &⟶ (λx\,y.\; x)\ z &⟶ λy.\;z
\end{aligned}$$

**Теорема (Чёрч — Россер):** Пусть $?e \xrightarrow{*} {?a}$ и $?e \xrightarrow{*} {?b}$. Тогда существует такое выражение $?c$, что $?a \xrightarrow{*} {?с}$ и $?b \xrightarrow{*} {?c}$.

Наглядно это можно изобразить диаграммой:

https://q.uiver.app/?q=WzAsNCxbMSwwLCI/ZSJdLFswLDEsIj9hIl0sWzIsMSwiP2IiXSxbMSwyLCI/YyJdLFswLDEsIioiLDJdLFswLDIsIioiXSxbMSwzLCIqIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzIsMywiKiIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==

Выражение $?a$ вычислительно равно выражению $?b$ (пишется $?a \equiv {?b}$),
если существует такое выражение $?c$, что $?a \xrightarrow{*} {?c}$ и $?b \xrightarrow{*} {?c}$.

Вычислительное равенство удволетворяет основным свойствам равенства:

- $?e ≡ {?e}$
- Если $?a \equiv {?b}$, то ${?b} \equiv {?a}$
- Если ${?a} ≡ {?b}$ и ${?b} ≡ {?c}$, то ${?a} ≡ {?c}$

Первые два свойства следуют непосредственно из определения. Последнее же непосредственно
следует из теоремы Чёрча — Россера, что проще всего показать диаграммой:

https://q.uiver.app/?q=WzAsNixbMCwwLCI/YSJdLFsyLDAsIj9iIl0sWzQsMCwiP2MiXSxbMSwxLCI/YWIiXSxbMywxLCI/YmMiXSxbMiwyLCI/YWJjIl0sWzAsMywiKiJdLFsxLDMsIioiLDJdLFsxLDQsIioiXSxbMiw0LCIqIiwyXSxbMyw1LCIqIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzQsNSwiKiIsMix7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==

Выражение $?n$ находится в нормальной форме, если оно не может быть редуцировано.
Мы говорим, что $?n$ является нормальной формой выражения $?e$, если ${?e} \xrightarrow{*} {?n}$
и $?n$ находится в нормальной форме.

Не каждое выражение имеет нормальную форму. Например:

$$\begin{aligned}
(λx.\;x\ x)\ (λx.\;x\ x) &⟶ (λx.\;x\ x)\ (λx.\;x\ x) &⟶ \dots \\
(λx.\;x\ x\ x)\ (λx.\;x\ x\ x) &⟶ (λx.\;x\ x\ x)\ (λx.\;x\ x\ x)\ (λx.\;x\ x\ x) &⟶ \dots
\end{aligned}$$

И даже если у выражения есть нормальная форма, не каждая стратегия вычисления к ней приводит.
Например, две стратегии вычисления одного и того же выражения:

$$\begin{aligned}
(λx\,y.\; y)\ ((λx.\;x\ x)\ (λx.\;x\ x)) &⟶ (λx\,y.\; y)\ ((λx.\;x\ x)\ (λx.\;x\ x)) &⟶ \dots \\
(λx\,y.\; y)\ ((λx.\;x\ x)\ (λx.\;x\ x)) &⟶ λy.\;y
\end{aligned}$$

Хотя теорема Чёрча — Россера гарантирует, что всегда есть способ достигнуть нормальной формы,
она не заставляет ему следовать.

Иногда нужно менее сильное условие, чем нормальная форма. Например, следующее выражение,
очевидно, не имеет нормальной формы:

$$λf.\;f\ ((λx.\;x\ x)\ (λx.\;x\ x))$$

Однако, если применить это выражение к $(λx\,y.\; y)$, то у результата нормальная форма уже есть.

Мы бы хотели вычислять только головное выражение $?h$ в $?h\ {?a_1}\ \dots\ {?a_n}$.

(головная нормальная форма)

Определим ГНФ рекурсивно:

- Любая переменная $?x$ в ГНФ
- $λ?x.\; ?e$ в ГНФ если $?e$ в ГНФ
- Если $?x$ — переменная, то $?x\ {?e_1}\ \dots\ {?e_n}$ в ГНФ

Выражение находится в слабой головной нормальной форме, если оно находится в ГНФ
или если оно имеет вид $λ?x.\; ?e$, где $?e$ это любое выражение (не обязательно в ГНФ).
